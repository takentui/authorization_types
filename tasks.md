Домашнее задание №4  
Тема: «JWT-авторизация в FastAPI» 

-------------------------------------------------------------------
## Task 1 — Токен без подписи (alg="none")  
• Цель: понять устройство JWT и риски незащищённых токенов.  
• Шаги:  
  – Реализовать эндпоинт `/login/unsigned` — выдаёт JWT без подписи (`{"alg":"none"}`).  
  – Положить в payload: `sub`, `iat`, `exp` (30 мин).  
  – Создать dependency `get_current_user_unsigned`, валидирующую срок действия.  
  – Добавить защищённый эндпоинт `/protected/unsigned`.

## Task 2 — Подписанный токен (HS256)  
• Цель: безопасный вариант JWT.  
• Шаги:  
  – Переменная окружения `JWT_SECRET`.  
  – Эндпоинт `/login` возвращает HS256-подписанный токен.  
  – Dependency `get_current_user` валидирует подпись и `exp`.  
  – Защищённый эндпоинт `/protected` использует эту dependency.

## Task 3 — «Remember me» TTL  
• Цель: разные сроки жизни токенов.  
• Шаги:  
  – Расширить `LoginRequest` полем `remember_me: bool = False`.  
  – Если `remember_me`, ставить `exp = now + 7 дней`, иначе 30 мин.  
  – Проверять TTL внутри dependency.

## Task 4 — База пользователей и роли  
• Цель: хранить пользователей и их роли без внешних БД.  
• Шаги:  
  – `users_db: dict[str, dict] = {username: {"password_hash": str, "roles": list[str]}}`.  
  – Использовать `passlib.hash.sha256_crypt` для хэшей.  
  – При логине помещать `roles` в payload (`roles": [...]`).

## Task 5 — Регистрация + немеденный токен  
• Цель: публичная ручка `/register` создаёт пользователя и сразу возвращает подписанный JWT.  
• Шаги:  
  – Проверять уникальность, хешировать пароль, принимать список ролей.  
  – В ответе — токен с этими ролями.

## Task 6 — Проверка ролей  
• Цель: доступ по ролям.  
• Шаги:  
  – Создать dependency `require_role(role: str)`; внутри проверять, что роль присутствует в `roles` токена.  
  – Добавить пример эндпоинта `/admin` доступный только `admin`-ролям.

## Task 7 — Тестирование  
• Инструменты: `pytest`, `httpx`.  
  – Тесты:  
    1. Регистрация → ответ содержит валидный токен.  
    2. Успешный логин (подписанный) возвращает токен.  
    3. Неверный пароль → 401.  
    4. `/protected` без токена → 401.  
    5. `/protected` с просроченным токеном → 401.  
    6. Remember-me токен живёт > 30 мин.  
    7. `/admin` c ролью `admin` → 200; без роли → 403.
